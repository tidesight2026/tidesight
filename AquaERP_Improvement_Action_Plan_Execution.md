# AquaERP โ ุฎุทุฉ ุชูููุฐูุฉ ูุชุญุณูู ุงูุงุณุชูุฑุงุฑ ูุงูุงุญุชุฑุงููุฉ

> ูุฐู ุงูุฎุทุฉ ุชูุฎูุต ูุฎุฑุฌุงุช ุงููุฑุงุฌุนุฉ ุงูุชูููุฉุ ูุชุญููููุง ุฅูู ููุงู ุนูููุฉ ูุงุจูุฉ ููุชูููุฐ.

---

## 1. ุฃููููุฉ ุนุงููุฉ โ ูุจู/ูุน ุฃู ูุดุฑ ุฅูุชุงุฌู

### 1.1 ุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ูุงูุจูุฆุฉ

- **ูููุฉ 1.1.1 โ ุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฅูุชุงุฌ ูู `.env`**
  - **ุงููุฏู:** ุถูุงู ุฃู ุฅุนุฏุงุฏุงุช ุงูุฅูุชุงุฌ ุขููุฉ ููุณุชููุฉ ุนู ุจูุฆุฉ ุงูุชุทููุฑ.
  - **ุงูุฎุทูุงุช:**
    - ุชุนููู `DEBUG=False` ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ููุท.
    - ุชุนููู `SECRET_KEY` ูููุฉ ูุนุดูุงุฆูุฉ ุชุฎุชูู ุนู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู `settings.py` ู `env.example`.
    - ุชุนููู `ALLOWED_HOSTS` ุนูู ูุทุงูุงุช ุงูุฅูุชุงุฌ ุงููุนููุฉ (ูุซู: `api.example.com`, `farm1.example.com`).
    - ุชุนููู `CSRF_TRUSTED_ORIGINS` ุจููุณ ูุทุงูุงุช ุงูู frontend/production.
    - ุถุจุท ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช `POSTGRES_*` ู `REDIS_URL` ุจููู ุฅูุชุงุฌูุฉ ุขููุฉ.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู `env.prod.example` ุจุฅุถุงูุฉ ุชุนูููุงุช ูุงุถุญุฉ ูุชุญุฐูุฑุงุช ุฃูููุฉ.
    - ุชู ุฅุถุงูุฉ `CORS_ALLOWED_ORIGINS` ูู ููู ุงูุฅูุชุงุฌ.
    - ุชู ุชุญุณูู ุงูุชูุซูู ููููุงุช ุงููุฑูุฑ ูุงูุฅุนุฏุงุฏุงุช ุงูุญุณุงุณุฉ.

- **ูููุฉ 1.1.2 โ ุญูุงูุฉ ูู ุณูุก ุงูุฅุนุฏุงุฏ ูู ุงูุฅูุชุงุฌ**
  - **ุงููุฏู:** ููุน ุชุดุบูู ุงูุชุทุจูู ูู ุงูุฅูุชุงุฌ ุจุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ุฎุทูุฑุฉ.
  - **ุงูุฎุทูุงุช (ููุชุฑุญ ูู `tenants/aqua_core/settings.py`):**
    - ุฅุถุงูุฉ ุชุญูู ุนูุฏ ุงูุฅููุงุน: ุฅุฐุง ูุงู `DEBUG=False` ู `SECRET_KEY` ูุง ุฒุงูุช ุจุงููููุฉ ุงูุงูุชุฑุงุถูุฉ โ ุฑูุน ุงุณุชุซูุงุก ูุงุถุญ.
    - ูููู ุฅุถุงูุฉ ุชุญุฐูุฑ ูุดุงุจู ุฅุฐุง ูุงูุช ุจูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃู `ALLOWED_HOSTS` ุจุงูููู ุงูุงูุชุฑุงุถูุฉ.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุฅุถุงูุฉ ูุญุต ุฃููู ูู `settings.py` ูุชุญูู ูู:
      - `SECRET_KEY` ุบูุฑ ุขูู (ุงูููู ุงูุงูุชุฑุงุถูุฉ ุฃู ุฃูู ูู 50 ุญุฑู) โ ุฑูุน ุงุณุชุซูุงุก ูู ุงูุฅูุชุงุฌ.
      - `ALLOWED_HOSTS` ุบูุฑ ูุญุฏุฏุฉ ุจุดูู ุตุญูุญ โ ุชุญุฐูุฑ/ุงุณุชุซูุงุก ุญุณุจ ุงูุจูุฆุฉ.
      - ูููุฉ ูุฑูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงููููุฉ ุงูุงูุชุฑุงุถูุฉ โ ุชุญุฐูุฑ.
    - ูุชู ุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ ุนูุฏ ุงูุชุดุงู ูุดุงูู ุฃูููุฉ.

### 1.2 CORS ูุงูุงุชุตุงู ุจุงููุงุฌูุฉ ุงูุฃูุงููุฉ

- **ูููุฉ 1.2.1 โ ุถุจุท CORS ูู ุงูุฅูุชุงุฌ**
  - **ุงููุฏู:** ุงูุณูุงุญ ููุท ููุทุงูุงุช frontend ุงูููุซููุฉ ุจุงููุตูู ููู API.
  - **ุงูุฎุทูุงุช:**
    - ุฅุนุฏุงุฏ ูุชุบูุฑ `CORS_ALLOWED_ORIGINS` ูู `.env` ููุฅูุชุงุฌ (ูุซุงู: `https://app.example.com`).
    - ุงูุชุฃูุฏ ุฃู `CORS_ALLOW_ALL_ORIGINS` ูุง ูููู ูุนุงููุง ูู ุงูุฅูุชุงุฌ (ูุจูู ูุฑุจูุทูุง ุจู `DEBUG`).
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู ููุทู CORS ูู `settings.py`:
      - ูู ุงูุฅูุชุงุฌ: ูุฑุงุกุฉ `CORS_ALLOWED_ORIGINS` ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ.
      - ุฅุถุงูุฉ ุชุญุฐูุฑ ุฅุฐุง ูู ูุชู ุชุนููู `CORS_ALLOWED_ORIGINS` ูู ุงูุฅูุชุงุฌ.
      - `CORS_ALLOW_ALL_ORIGINS` ูุฑุจูุท ุจู `DEBUG` (ูุนุงู ููุท ูู ุงูุชุทููุฑ).
    - ุชู ุฅุถุงูุฉ `CORS_ALLOWED_ORIGINS` ูู `env.prod.example` ูุน ุฃูุซูุฉ ูุงุถุญุฉ.

### 1.3 ูุฑุงุฌุนุฉ ููุงุท ุงูุชูุซูู ูุงูุฃุฎุทุงุก

- **ูููุฉ 1.3.1 โ ุชุญุณูู ุงูุชุนุงูู ูุน ุฃุฎุทุงุก JWT ู TokenAuth**
  - **ุงููุฏู:** ุชุญุณูู ุงูุฃูุงู ููุงุจููุฉ ุงูุชุชุจุน ุจุฏูู ูุดู ูุนูููุงุช ุญุณุงุณุฉ.
  - **ุงูุฎุทูุงุช:**
    - ูู `api/auth.py` ุฏุงุฎู `TokenAuth.authenticate`:
      - ุชุณุฌูู ุงูุฃุฎุทุงุก (logging) ุจูุณุชูู WARNING ุนูุฏ ูุดู ุงูุชุญูู ูู ุงูุชูููุ ุฏูู ุทุจุงุนุฉ ุงูุชููู ููุณู.
      - ุฅุจูุงุก ูุงุฌูุฉ ุงูู API ุชุฑุฌุน ุฑุณุงุฆู ุนุงูุฉ ูููุณุชุฎุฏู.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู `TokenAuth.authenticate` ูู `api/auth.py`:
      - ุฅุถุงูุฉ logging ุขูู ุจูุณุชููุงุช ูุฎุชููุฉ (WARNING ููู InvalidToken/TokenErrorุ ERROR ููุฃุฎุทุงุก ุบูุฑ ุงููุชููุนุฉ).
      - ุชุณุฌูู ูุนูููุงุช ูููุฏุฉ (ููุน ุงูุฎุทุฃุ ุงููุณุงุฑุ IP) ุฏูู ูุดู ูุญุชูู Token.
      - ูุนุงูุฌุฉ ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฃุฎุทุงุก (InvalidToken, TokenError, Exception ุนุงู).
      - ุฅุถุงูุฉ ุฏุงูุฉ `_get_client_ip` ููุญุตูู ุนูู IP ุงูุนููู ุจุดูู ุขูู.

---

## 2. ุฃููููุฉ ูุชูุณุทุฉ โ ุฃุฏุงุก ูุงุณุชูุฑุงุฑูุฉ ุนูู ุงููุฏู ุงููุชูุณุท

### 2.1 ุชุญุณูู ุงุณุชุนูุงูุงุช ORM

- **ูููุฉ 2.1.1 โ ุฅุถุงูุฉ `select_related` ู `prefetch_related` ูู ุงูู APIs ุงูุซูููุฉ**
  - **ุงููุฏู:** ุชูููู ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช (N+1 Problem) ูู ุงูุดุงุดุงุช ุงูุชู ุชุนุฑุถ ุจูุงูุงุช ูุชุฑุงุจุทุฉ.
  - **ุงูุฎุทูุงุช:**
    - ุชุญุฏูุฏ Endpoints ุฐุงุช ุงูููุงุฆู ุงููุจูุฑุฉ ูู ุชุทุจููุงุช: `biological`, `inventory`, `daily_operations`, `sales`, `audit`.
    - ุฅุถุงูุฉ `select_related()` ููุนูุงูุงุช ูู ููุน `ForeignKey` (ูุซู: userุ clientุ planุ feed_typeโฆ).
    - ุฅุถุงูุฉ `prefetch_related()` ููุนูุงูุงุช ูู ููุน `ManyToMany` ุฃู ุงูุนูุณ.
    - ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ูุซู `django-debug-toolbar` ูู ุจูุฆุฉ ุงูุชุทููุฑ ููุฑุงูุจุฉ ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ูู `api/operations.py` (FeedingLog, MortalityLog)
    - ุชู ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ูู `api/sales.py` (Harvest, SalesOrder)
    - ุชู ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ูู `api/ponds.py` ู `api/batches.py`
    - ุชู ุฅุถุงูุฉ `select_related` ูู ุฌููุน ุนูููุงุช GET/PUT/DELETE

### 2.2 ุฅุฏุงุฑุฉ ุญุฌู Audit Log

- **ูููุฉ 2.2.1 โ ูุถุน ุณูุงุณุฉ Retention ูุณุฌูุงุช ุงูุชุฏููู**
  - **ุงููุฏู:** ููุน ุชุถุฎู ุฌุฏูู `AuditLog` ูุชุฃุซูุฑู ุนูู ุงูุฃุฏุงุก.
  - **ุงูุฎุทูุงุช:**
    - ุชุญุฏูุฏ ุณูุงุณุฉ ุงุญุชูุงุธ (ูุซูุงู: ุงูุงุญุชูุงุธ ุจุณุฌูุงุช ุขุฎุฑ 12 ุดูุฑูุง ููุทุ ุฃู ุฃุฑุดูุฉ ุงูุฃูุฏู ูู ุฌุฏูู/ูุงุนุฏุฉ ุฃุฎุฑู).
    - ุฅูุดุงุก ูููุฉ ุฏูุฑูุฉ (Celery beat task) ุชููู ุจุญุฐู/ุฃุฑุดูุฉ ุงูุณุฌูุงุช ุงูุฃูุฏู ูู ุงููุฏุฉ ุงููุญุฏุฏุฉ.
    - ุงูุชุฃูุฏ ูู ูุฌูุฏ ููุฑุณ ุนูู `created_at` (ููุฌูุฏ ุญุงูููุง โ ููุท ุงูุชุญูู).
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุฅูุดุงุก `audit/tasks.py` ูุน ูููุฉ `cleanup_old_audit_logs`
    - ุชู ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช `AUDIT_LOG_RETENTION_MONTHS` ู `AUDIT_LOG_CLEANUP_BATCH_SIZE` ูู settings.py
    - ุชู ุฅุถุงูุฉ ูููุฉ ูุฌุฏููุฉ ูู `CELERY_BEAT_SCHEDULE` (ูู ุฃุณุจูุน ููู ุงูุฃุญุฏ ุงูุณุงุนุฉ 2 ุตุจุงุญุงู)
    - ุงููููุฉ ุชุญุฐู ุงูุณุฌูุงุช ุนูู ุฏูุนุงุช ูุชุฌูุจ ุงูุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    - ุชู ุงูุชุญูู ูู ูุฌูุฏ ููุฑุณ ุนูู `created_at` (ููุฌูุฏ ุจุงููุนู)

### 2.3 ุฏูุฑุฉ ุญูุงุฉ ุงูุงุดุชุฑุงูุงุช (SaaS Lifecycle)

- **ูููุฉ 2.3.1 โ ุฅูุดุงุก ุทุจูุฉ ุฎุฏูุงุช ูุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงู**
  - **ุงููุฏู:** ุชูุญูุฏ ููุทู ุชุบููุฑ ุญุงูุฉ ุงูุงุดุชุฑุงู ุจูู `Client`, `Subscription`, `PlatformInvoice`.
  - **ุงูุฎุทูุงุช:**
    - ุฅูุดุงุก ููู ุฎุฏูุฉ (Service) ุฃู Utils ุฏุงุฎู `tenants` ุฃู `api/saas` ูุญุชูู ุฏูุงู ูุซู:
      - `activate_subscription(client, plan, billing_cycle, ...)`.
      - `cancel_subscription(subscription, reason)`.
      - `mark_subscription_past_due(subscription)`.
    - ุงูุชุฃูุฏ ุฃู ูุฐู ุงูุฏูุงู:
      - ุชุญุฏูุซ `Client.is_active_subscription` ูุญููู `Subscription.status`, `current_period_end`, ุฅูุฎุ ูู ููุงู ูุงุญุฏ.
      - ุชูุดุฆ ุฃู ุชุญุฏูุซ ุณุฌูุงุช `PlatformInvoice` ุนูุฏ ุงูุญุงุฌุฉ.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุฅูุดุงุก `tenants/aqua_core/services/subscription_service.py` ูุน ูุฆุฉ `SubscriptionService`
    - ุชู ุชูููุฐ ุงูุฏูุงู ุงูุชุงููุฉ:
      - `activate_subscription()` - ุชูุนูู/ุชุฌุฏูุฏ ุงุดุชุฑุงู
      - `cancel_subscription()` - ุฅูุบุงุก ุงุดุชุฑุงู (ููุฑู ุฃู ูู ููุงูุฉ ุงููุชุฑุฉ)
      - `mark_subscription_past_due()` - ุชุนููู ุงูุงุดุชุฑุงู ููุชุฃุฎุฑ
      - `suspend_subscription()` - ุชุนููู ุงูุงุดุชุฑุงู
      - `renew_subscription()` - ุชุฌุฏูุฏ ุงุดุชุฑุงู ูุน ุฅูุดุงุก ูุงุชูุฑุฉ
    - ุฌููุน ุงูุฏูุงู ุชุญุฏูุซ `Client.is_active_subscription` ู `Subscription.status` ุจุดูู ูุชุณู

- **ูููุฉ 2.3.2 โ ููุงู ุฏูุฑูุฉ ููุชุงุจุนุฉ ุงูุงุดุชุฑุงูุงุช**
  - **ุงููุฏู:** ุฅููุงู ุฃู ุชุนููู ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ ุชููุงุฆููุง.
  - **ุงูุฎุทูุงุช:**
    - ุฅูุดุงุก ูููุฉ Celery ุฏูุฑูุฉ ุชุชุญูู ูู ุงูุงุดุชุฑุงูุงุช ุงูุชู `current_period_end` ููุง < ุงูุขู.
    - ุชุญุฏูุซ ุญุงูุฉ ูุฐู ุงูุงุดุชุฑุงูุงุช ุฅูู `past_due` ุฃู `suspended` ุญุณุจ ุณูุงุณุฉ ุงูุนูู.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุฅูุดุงุก `tenants/tasks.py` ูุน ูููุฉ `check_expired_subscriptions`
    - ุงููููุฉ ุชุชุญูู ูู:
      - ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ ุงูููุชููุฉ โ ุชุตุจุญ `past_due`
      - ุงูุงุดุชุฑุงูุงุช ุงููุชุฃุฎุฑุฉ ูุฃูุซุฑ ูู 7 ุฃูุงู โ ุชุตุจุญ `suspended`
      - ุงูุงุดุชุฑุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงูููุชููุฉ โ ุชุตุจุญ `past_due`
    - ุชู ุฅุถุงูุฉ ุงููููุฉ ุฅูู `CELERY_BEAT_SCHEDULE` (ููููุงู ุงูุณุงุนุฉ 3 ุตุจุงุญุงู)
    - ุงููููุฉ ุชุณุชุฎุฏู `SubscriptionService` ูุถูุงู ุงูุงุชุณุงู

---

## 3. ุฃููููุฉ ูุชูุณุทุฉ/ููุฎูุถุฉ โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### 3.1 ุฅุฏุงุฑุฉ ุงูุงุชุตุงู ุจุงูู API ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

- **ูููุฉ 3.1.1 โ ุฅูุดุงุก Axios Instance ููุญูุฏ**
  - **ุงููุฏู:** ุชูุญูุฏ ุทุฑููุฉ ุงูุงุชุตุงู ุจุงูู API ูุงูุชุนุงูู ูุน ุงูุชูููุงุช ูุงูุฃุฎุทุงุก.
  - **ุงูุฎุทูุงุช:**
    - ุฏุงุฎู `frontend/src/services` ุฅูุดุงุก ููู (ูุซูุงู: `apiClient.ts`) ูุญุชูู:
      - Axios instance ูุน `baseURL` ูุฃุฎูุฐุฉ ูู ูุชุบูุฑ ุจูุฆุฉ (VITE_API_URL).
      - Interceptor ูุถูู `Authorization: Bearer <access_token>` ูู `useAuthStore` ุฃู ูู localStorage.
      - Interceptor ููุฃุฎุทุงุก ููุชุนุงูู ูุน 401/403 (ุชุฌุฏูุฏ ุงูุชููู ุฃู ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู `/login`).
    - ุชุญุฏูุซ ุฎุฏูุงุช ุงูู API ุงูุญุงููุฉ ูุงุณุชุฎุฏุงู ูุฐุง ุงูู instance.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู `frontend/src/services/api.ts`:
      - ุชุญุณูู Response Interceptor ููุชุนุงูู ูุน 401, 403, 500+ ุจุดูู ุฃูุถู
      - ุฅุถุงูุฉ ุชุฃุฎูุฑ ูุจู ุฅุนุงุฏุฉ ุงูุชูุฌูู ููุณูุงุญ ุจุนุฑุถ ุฑุณุงูุฉ ุงูุฎุทุฃ
      - ุชุญุณูู ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฎุงุฏู
    - Axios instance ููุฌูุฏ ุจุงููุนู ููุณุชุฎุฏู `API_BASE_URL` ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

- **ูููุฉ 3.1.2 โ Global Error & Loading Handling**
  - **ุงููุฏู:** ุชูุญูุฏ ุนุฑุถ ุงูุฃุฎุทุงุก ูุงูุชุญููู ูููุณุชุฎุฏู.
  - **ุงูุฎุทูุงุช:**
    - ุฅูุดุงุก ูููููุงุช ุนุงูุฉ ููู Loader (spinner) ูุงูุฑุณุงุฆู (toasts/snackbar).
    - ุฑุจุทูุง ุจุญุงูุฉ ุนุงูุฉ (Zustand store) ูุนุฑุถ/ุฅุฎูุงุก ุงูุฑุณุงุฆู ูุงูุชุญููู ุจุดูู ูุฑูุฒู.
    - ุงุณุชุฎุฏุงู ูุฐู ุงููููููุงุช ูู ุงูุตูุญุงุช ุงูุฑุฆูุณูุฉ (Dashboard, Inventory, Sales, โฆ).
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุฅูุดุงุก `frontend/src/store/uiStore.ts` - Zustand store ูุฅุฏุงุฑุฉ ุญุงูุฉ UI:
      - `isLoading` ู `loadingMessage` - ุญุงูุฉ ุงูุชุญููู
      - `toasts` - ูุงุฆูุฉ ุฑุณุงุฆู Toast
      - ุฏูุงู ูุณุงุนุฏุฉ: `success()`, `error()`, `warning()`, `info()`
    - ุชู ุฅูุดุงุก `frontend/src/components/common/GlobalLoader.tsx` - ูููู Loader ุนุงู
    - ุชู ุฅูุดุงุก `frontend/src/components/common/ToastContainer.tsx` - ุญุงููุฉ Toast
    - ุชู ุฅุถุงูุฉ ุงูููููุงุช ุฅูู `App.tsx` ูุนุฑุถูุง ุจุดูู ูุฑูุฒู
    - ูููู ุงุณุชุฎุฏุงู `useUIStore` ูู ุฃู ุตูุญุฉ ูุนุฑุถ/ุฅุฎูุงุก ุงูุชุญููู ูุงูุฑุณุงุฆู

### 3.2 ุฏุนู RTL ูุชุฌุฑุจุฉ ุงูุนุฑุจูุฉ

- **ูููุฉ 3.2.1 โ ุชุญุณูู ุฏุนู RTL**
  - **ุงููุฏู:** ุชุฌุฑุจุฉ ุนุฑุจูุฉ ูุฑูุญุฉ ููุชูุงุณูุฉ.
  - **ุงูุฎุทูุงุช:**
    - ุงูุชุฃูุฏ ูู ุฃู ุงูู `<html dir="rtl" lang="ar">` ููุนูู ุนูุฏ ุงุฎุชูุงุฑ ุงููุบุฉ ุงูุนุฑุจูุฉ.
    - ุถุจุท Tailwind ุฃู CSS ูุฏุนู RTL (ุฅุถุงูุฉ ููุชุจุฉ RTL Tailwind ุฅุฐุง ูุฒู).
    - ุงูุชุญูู ูู ุงูุตูุญุงุช ุงูุฑุฆูุณูุฉ (Login, Dashboard, Forms) ุจุตุฑููุง.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู `frontend/src/main.tsx`:
      - ุฅุถุงูุฉ ุชุญุฏูุซ ุฏููุงูููู ูู `dir` ู `lang` ูู `<html>` ุนูุฏ ุชุบููุฑ ุงููุบุฉ
      - ุงูุงุณุชูุงุน ูุชุบููุฑุงุช ุงููุบุฉ ูู i18n
      - ุชุนููู ุงูููู ุงูุฃูููุฉ ุนูุฏ ุงูุชุญููู
    - `index.html` ูุญุชูู ุจุงููุนู ุนูู `dir="rtl" lang="ar"` ูููู ุงูุชุฑุงุถูุฉ
    - `LanguageSwitcher` ูุญุฏุซ `dir` ู `lang` ุนูุฏ ุชุบููุฑ ุงููุบุฉ
    - `index.css` ูุญุชูู ุนูู `direction: rtl` ุงูุชุฑุงุถู
    - Tailwind ููุนุฏ ูุฏุนู RTL (corePlugins.preflight ููุนู)

---

## 4. ุฃููููุฉ ุชูุธูููุฉ โ ุฅุนุฏุงุฏุงุชุ ูุดุฑุ ููุฑุงูุจุฉ

### 4.1 ุชูุธูู ุฅุนุฏุงุฏุงุช Django

- **ูููุฉ 4.1.1 โ ูุตู ุฃู ุชุดุฏูุฏ ุฅุนุฏุงุฏุงุช dev/prod**
  - **ุงููุฏู:** ุชูููู ุงุญุชูุงูุงุช ุฎูุท ุฅุนุฏุงุฏุงุช ุงูุชุทููุฑ ุจุงูุฅูุชุงุฌ.
  - **ุงูุฎุทูุงุช (ุฃุญุฏ ุงูุฎูุงุฑูู):**
    - **ุฎูุงุฑ A:** ุฅูุดุงุก `settings_base.py`, `settings_dev.py`, `settings_prod.py`ุ ูุน ุชุนููู `DJANGO_SETTINGS_MODULE` ุญุณุจ ุงูุจูุฆุฉ.
    - **ุฎูุงุฑ B:** ุงูุฅุจูุงุก ุนูู ููู ูุงุญุฏุ ูุน ุชุดุฏูุฏ ููุทู ุงูุชูุฑูุฉ ุจูู `DEBUG=True/False`ุ ูุฅุถุงูุฉ ุชุญุฐูุฑุงุช/ุงุณุชุซูุงุกุงุช ูููุฉ ููุง ูู ูููุฉ 1.1.2.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done) - ุฎูุงุฑ B.
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู ูุญูุตุงุช ุงูุฃูุงู ูู `settings.py`:
      - ุฅุถุงูุฉ ูุญุต Redis (ุชุญุฐูุฑ ุฅุฐุง ูุงู ุจุฏูู ูููุฉ ูุฑูุฑ ูู ุงูุฅูุชุงุฌ)
      - ุฅุถุงูุฉ ูุญุต STATIC_ROOT ู MEDIA_ROOT (ุชุญุฐูุฑ ุฅุฐุง ูุงูุง ุจุงููุณุงุฑุงุช ุงูุงูุชุฑุงุถูุฉ ูู ุงูุฅูุชุงุฌ)
      - ุฑูุน ุงุณุชุซูุงุกุงุช ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ (`ENVIRONMENT=production`) ุนูุฏ ุงูุชุดุงู ูุดุงูู ุฃูููุฉ
    - ุฌููุน ุงููุญูุตุงุช ููุฌูุฏุฉ ูู ูุณู `PRODUCTION SECURITY CHECKS`

### 4.2 ุงููุดุฑ ูุงููุฑุงูุจุฉ

- **ูููุฉ 4.2.1 โ ุงูุชุฃูุฏ ูู ุฌูุน staticfiles ูู ุงูุฅูุชุงุฌ**
  - **ุงููุฏู:** ุนูู ุตุญูุญ ูููููุงุช ุงูุซุงุจุชุฉ (Django Adminุ ูููุงุช ุงููุธุงู) ูู ุงูุฅูุชุงุฌ.
  - **ุงูุฎุทูุงุช:**
    - ูู Dockerfile ุฃู ุฎุทูุงุช CI/CDุ ุฅุถุงูุฉ:
      - `python manage.py collectstatic --noinput` ูุจู ุชุดุบูู ุงูุณูุฑูุฑ.
    - ุงูุชุฃูุฏ ูู ุฃู `STATIC_ROOT` ู `MEDIA_ROOT` ูู `.env` ุงูุฅูุชุงุฌูุฉ ุชุชูุงูู ูุน ุฅุนุฏุงุฏุงุช ุงูุณูุฑูุฑ/ุงูุญุงููุฉ.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - `entrypoint.sh` ูุญุชูู ุจุงููุนู ุนูู `python manage.py collectstatic --noinput --clear`
    - ูุชู ุชูููุฐ collectstatic ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุญุงููุฉ
    - `Dockerfile` ููุดุฆ ูุฌูุฏุงุช `/app/staticfiles` ู `/app/media`
    - `docker-compose.prod.yml` ูุณุชุฎุฏู volumes ูููุตูุฉ ููู staticfiles ู media

- **ูููุฉ 4.2.2 โ ุฅุถุงูุฉ Health Check Endpoints**
  - **ุงููุฏู:** ุชุณููู ูุฑุงูุจุฉ ุฌุงูุฒูุฉ ุงูุชุทุจูู ูู ุฃุฏูุงุช ุงูู DevOps.
  - **ุงูุฎุทูุงุช:**
    - ุฅูุดุงุก Endpoint ุจุณูุท (ูุซูุงู `/api/health`) ูุชุญูู ูู:
      - ุฅููุงููุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.
      - ุฅููุงููุฉ ุงูุงุชุตุงู ุจู Redis.
    - ุงุณุชุฎุฏุงู ูุฐุง ุงูู endpoint ูู Health checks ุนูู ูุณุชูู Kubernetes/Load Balancer ุฅู ูุฌุฏ.
  - **ุงูุญุงูุฉ:** โ ุชู ุงูุชูููุฐ (Done).
  - **ุงูุชูุงุตูู:**
    - ุชู ุชุญุณูู `/api/dashboard/health` endpoint ูู `api/dashboard.py`:
      - ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุชูููุฐ ุงุณุชุนูุงู ุจุณูุท)
      - ุงูุชุญูู ูู Redis/Cache (ุงุฎุชุจุงุฑ set/get)
      - ุฅุฑุฌุงุน ุญุงูุฉ ููุตูุฉ ููู ุฎุฏูุฉ
      - ุฅุฑุฌุงุน 503 ุฅุฐุง ูุงูุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ
      - ุฅุถุงูุฉ timestamp ููุงุณุชุฌุงุจุฉ
    - ูููู ุงุณุชุฎุฏุงูู ูู Kubernetes/Load Balancer health checks
    - ูุนูุฏ `healthy`, `degraded`, ุฃู `unhealthy` ุญุณุจ ุญุงูุฉ ุงูุฎุฏูุงุช

---

## 5. ุฃุณููุจ ุงูุนูู ุงูููุชุฑุญ ูุชูููุฐ ุงูุฎุทุฉ

1. **ูุฑุญูุฉ 1 โ ุงูุฃูุงู ูุงูุฅุนุฏุงุฏุงุช (ุฃุณุจูุน 1):**
   - ุชูููุฐ ููุงู ุงููุณู (1) ุจุงููุงูู.
2. **ูุฑุญูุฉ 2 โ ุงูุฃุฏุงุก ูุงูู SaaS (ุฃุณุจูุน 2โ3):**
   - ุชูููุฐ ููุงู ุงูุฃูุณุงู (2.1)ุ (2.2)ุ (2.3).
3. **ูุฑุญูุฉ 3 โ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ุฃุณุจูุน 3โ4):**
   - ุชูููุฐ ููุงู ุงููุณู (3).
4. **ูุฑุญูุฉ 4 โ ุงูุชุญุณููุงุช ุงูุชูุธูููุฉ ูุงููุดุฑ (ุฃุณุจูุน 4):**
   - ุชูููุฐ ููุงู ุงููุณู (4).

ูููู ุชุญุฏูุซ ูุฐุง ุงูููู ุฏูุฑููุง ุจูุถุน ุญุงูุฉ ููู ูููุฉ: `To Do` / `In Progress` / `Done`ุ ูุชุชุจุน ุงูุชูุฏู ุฃุซูุงุก ุชูููุฐ ุงูุชุญุณููุงุช.

---

## ๐ ููุฎุต ุงูุชูุฏู

### โ ุงููุฑุญูุฉ 1 - ุงูุฃูุงู ูุงูุฅุนุฏุงุฏุงุช (ููุชููุฉ)

ุชู ุชูููุฐ ุฌููุน ููุงู ุงููุฑุญูุฉ 1 ุจูุฌุงุญ:

1. โ **ูููุฉ 1.1.1** - ุชุญุณูู `env.prod.example` ุจุฅุถุงูุฉ ุชุนูููุงุช ูุชุญุฐูุฑุงุช ุฃูููุฉ ูุงุถุญุฉ
2. โ **ูููุฉ 1.1.2** - ุฅุถุงูุฉ ูุญูุตุงุช ุฃูููุฉ ูู `settings.py` ููุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช ุงูุฎุทูุฑุฉ
3. โ **ูููุฉ 1.2.1** - ุชุญุณูู ุฅุนุฏุงุฏุงุช CORS ูุน ุชุญุฐูุฑุงุช ูู ุงูุฅูุชุงุฌ
4. โ **ูููุฉ 1.3.1** - ุชุญุณูู `TokenAuth` ุจุฅุถุงูุฉ logging ุขูู ูููุตู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `env.prod.example` - ุชุญุณูู ุงูุชูุซูู ูุงูุฅุนุฏุงุฏุงุช
- `tenants/aqua_core/settings.py` - ุฅุถุงูุฉ ูุญูุตุงุช ุฃูููุฉ ูุชุญุณูู CORS
- `api/auth.py` - ุชุญุณูู logging ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก

**ุงูุชุงุฑูุฎ:** ุชู ุงูุชูููุฐ ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ

---

### โ ุงููุฑุญูุฉ 2 - ุงูุฃุฏุงุก ูุงูู SaaS (ููุชููุฉ)

ุชู ุชูููุฐ ุฌููุน ููุงู ุงููุฑุญูุฉ 2 ุจูุฌุงุญ:

1. โ **ูููุฉ 2.1.1** - ุชุญุณูู ุงุณุชุนูุงูุงุช ORM ูู ุฌููุน ุงูู APIs
2. โ **ูููุฉ 2.2.1** - ุณูุงุณุฉ Retention ูุณุฌูุงุช ุงูุชุฏููู ูุน ูููุฉ Celery ุฏูุฑูุฉ
3. โ **ูููุฉ 2.3.1** - ุทุจูุฉ ุฎุฏูุงุช ูุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงู (SubscriptionService)
4. โ **ูููุฉ 2.3.2** - ูููุฉ Celery ุฏูุฑูุฉ ููุชุงุจุนุฉ ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ

**ุงููููุงุช ุงูุฌุฏูุฏุฉ/ุงููุนุฏูุฉ:**
- `audit/tasks.py` - ูููุฉ ุชูุธูู ุณุฌูุงุช ุงูุชุฏููู
- `tenants/tasks.py` - ูููุฉ ูุชุงุจุนุฉ ุงูุงุดุชุฑุงูุงุช
- `tenants/aqua_core/services/subscription_service.py` - ุฎุฏูุฉ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
- `tenants/aqua_core/settings.py` - ุฅุถุงูุฉ CELERY_BEAT_SCHEDULE
- ุชุญุณููุงุช ูู `api/operations.py`, `api/sales.py`, `api/ponds.py`, `api/batches.py`

**ุงูุชุงุฑูุฎ:** ุชู ุงูุชูููุฐ ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ

---

### โ ุงููุฑุญูุฉ 3 - ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ููุชููุฉ)

ุชู ุชูููุฐ ุฌููุน ููุงู ุงููุฑุญูุฉ 3 ุจูุฌุงุญ:

1. โ **ูููุฉ 3.1.1** - ุชุญุณูู Axios Instance ูุน interceptors ูุญุณููุฉ
2. โ **ูููุฉ 3.1.2** - Global Error & Loading Handling ูุน Zustand store
3. โ **ูููุฉ 3.2.1** - ุชุญุณูู ุฏุนู RTL ูุน ุชุญุฏูุซ ุฏููุงูููู ูู dir ู lang

**ุงููููุงุช ุงูุฌุฏูุฏุฉ/ุงููุนุฏูุฉ:**
- `frontend/src/store/uiStore.ts` - Zustand store ูุฅุฏุงุฑุฉ UI
- `frontend/src/components/common/GlobalLoader.tsx` - ูููู Loader ุนุงู
- `frontend/src/components/common/ToastContainer.tsx` - ุญุงููุฉ Toast
- `frontend/src/App.tsx` - ุฅุถุงูุฉ GlobalLoader ู ToastContainer
- `frontend/src/main.tsx` - ุชุญุณูู ุฏุนู RTL
- `frontend/src/services/api.ts` - ุชุญุณูู Response Interceptor

**ุงูุชุงุฑูุฎ:** ุชู ุงูุชูููุฐ ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ

---

### โ ุงููุฑุญูุฉ 4 - ุงูุชุญุณููุงุช ุงูุชูุธูููุฉ ูุงููุดุฑ (ููุชููุฉ)

ุชู ุชูููุฐ ุฌููุน ููุงู ุงููุฑุญูุฉ 4 ุจูุฌุงุญ:

1. โ **ูููุฉ 4.1.1** - ุชุดุฏูุฏ ุฅุนุฏุงุฏุงุช dev/prod ูุน ูุญูุตุงุช ุฃูููุฉ ุฅุถุงููุฉ
2. โ **ูููุฉ 4.2.1** - ุงูุชุฃูุฏ ูู collectstatic ูู entrypoint.sh
3. โ **ูููุฉ 4.2.2** - ุชุญุณูู Health Check Endpoint ูุน ูุญุต DB ู Redis

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `tenants/aqua_core/settings.py` - ุฅุถุงูุฉ ูุญูุตุงุช ุฃูููุฉ ุฅุถุงููุฉ (Redis, STATIC_ROOT, MEDIA_ROOT)
- `api/dashboard.py` - ุชุญุณูู `/api/dashboard/health` endpoint
- `entrypoint.sh` - ูุญุชูู ุจุงููุนู ุนูู collectstatic (ุชู ุงูุชุญูู)

**ุงูุชุงุฑูุฎ:** ุชู ุงูุชูููุฐ ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ

---

## ๐ ููุฎุต ููุงุฆู - ุฌููุน ุงููุฑุงุญู ููุชููุฉ!

ุชู ุชูููุฐ ุฌููุน ููุงู ุฎุทุฉ ุงูุชุญุณูู ุจูุฌุงุญ:

### โ ุงููุฑุญูุฉ 1 - ุงูุฃูุงู ูุงูุฅุนุฏุงุฏุงุช
- ูุญูุตุงุช ุฃูููุฉ ูููุฉ
- ุชุญุณูู CORS
- ุชุญุณูู JWT logging

### โ ุงููุฑุญูุฉ 2 - ุงูุฃุฏุงุก ูุงูู SaaS
- ุชุญุณูู ุงุณุชุนูุงูุงุช ORM
- ุณูุงุณุฉ Retention ูุณุฌูุงุช ุงูุชุฏููู
- ุทุจูุฉ ุฎุฏูุงุช ูุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
- ููุงู ุฏูุฑูุฉ ููุชุงุจุนุฉ ุงูุงุดุชุฑุงูุงุช

### โ ุงููุฑุญูุฉ 3 - ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- Global Error & Loading Handling
- ุชุญุณูู ุฏุนู RTL
- ุชุญุณูู Axios Instance

### โ ุงููุฑุญูุฉ 4 - ุงูุชุญุณููุงุช ุงูุชูุธูููุฉ ูุงููุดุฑ
- ุชุดุฏูุฏ ุฅุนุฏุงุฏุงุช dev/prod
- Health Check Endpoints ูุญุณููุฉ
- collectstatic ูู ุงูุฅูุชุงุฌ

**๐ ุงููุดุฑูุน ุฌุงูุฒ ุงูุขู ููุฅูุชุงุฌ ุจูุนุงููุฑ ุงุญุชุฑุงููุฉ!**

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุฑุจุท ุงูุฎุทุฉ ูุน ุฎุทุฉ ุงูุชุทููุฑ ุงูุฑุฆูุณูุฉ

ูุฐู ุงูุฎุทุฉ (`AquaERP_Improvement_Action_Plan_Execution.md`) ุชุฑูุฒ ุนูู:
- **ุงูุฃูุงู ูุงูุฅุนุฏุงุฏุงุช** (ุงููุฑุญูุฉ 1)
- **ุงูุฃุฏุงุก ูุงูู SaaS** (ุงููุฑุญูุฉ 2)
- **ุงููุงุฌูุฉ ุงูุฃูุงููุฉ** (ุงููุฑุญูุฉ 3)
- **ุงููุดุฑ ูุงููุฑุงูุจุฉ** (ุงููุฑุญูุฉ 4)

ุจูููุง ุฎุทุฉ ุงูุชุทููุฑ ุงูุฑุฆูุณูุฉ (`AquaERP_Improvement_Action_Plan_Execution_Plan.md`) ุชุฑูุฒ ุนูู:
- **ุชุญููู ุงููุฌูุงุช** (ุงููุฑุญูุฉ 1) โ
- **ุชูููุฉ ุงููุธุงุฆู ุงูุฌููุฑูุฉ** (ุงููุฑุญูุฉ 2) โ
- **ุชุญุณูู ูุงุฌูุฉ ุงูุงุณุชุฎุฏุงู ูุงูุชูุงุฑูุฑ** (ุงููุฑุญูุฉ 3) โ
- **ุงูุชูุงููุงุช ูุงูุฌูุฏุฉ ูุงูุฃูู** (ุงููุฑุญูุฉ 4) โ

**ุงูุฎูุงุตุฉ:** ููุง ุงูุฎุทุชูู ููุชููุชุงู ูุชูููุงู ุจุนุถููุง ุงูุจุนุถ! ๐

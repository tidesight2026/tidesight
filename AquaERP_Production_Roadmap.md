# ๐ AquaERP: ุฎุงุฑุทุฉ ุทุฑูู ุงูุฌุงูุฒูุฉ ููุฅูุชุงุฌ (Production Readiness Roadmap)

**ุงูุญุงูุฉ:** ูุณูุฏุฉ ููุชูููุฐ  
**ุงููุฏู:** ููู ูุธุงู AquaERP ูู ุจูุฆุฉ ุงูุชุทููุฑ ุงููุญููุฉ ุฅูู ุจูุฆุฉ ุฅูุชุงุฌ ุญูุฉุ ุขููุฉุ ููุงุจูุฉ ููุชูุณุน.  
**ุงููุฑุฌุน:** ุงูุจููุฉ ุงูุญุงููุฉ (Django-Tenants + React + Docker).

---

## ุงููุฑุญูุฉ 1: ุชุญุตูู ุงูุชุทุจูู ูุงูุฃูุงู (Security Hardening)

*ุงููุฏู: ุฅุบูุงู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ูููุน ุชุณุฑูุจ ุงูุจูุงูุงุช ูุจู ุงููุดุฑ.*

### 1. ุฅุฏุงุฑุฉ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ (Environment Variables)

- [ ] **ูุตู ุงูุฅุนุฏุงุฏุงุช:** ุฅูุดุงุก ููู `.env.prod` ูุฎุตุต ููุฅูุชุงุฌ ูุง ูุชู ุฑูุนู ุนูู GitHub.
- [ ] **ุงูููุงุชูุญ ุงูุญุณุงุณุฉ:**
  - ุชูููุฏ `SECRET_KEY` ุฌุฏูุฏ ุทููู ูุนุดูุงุฆู (50+ ุญุฑู).
  - ุชุนููู `DEBUG=False` (ุฅูุฒุงูู).
  - ุชุฃููู ุจูุงูุงุช ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ู Redis ุจูููุงุช ูุฑูุฑ ูุนูุฏุฉ.
- [ ] **ุชุฃููู ZATCA:** ุชุฎุฒูู ููุงุชูุญ ุงูุชุดููุฑ ุงูุฎุงุตุฉ (Private Keys) ุฅูุง ูู ูุชุบูุฑุงุช ุจูุฆุฉ ูุดูุฑุฉ ุฃู ุจุงุณุชุฎุฏุงู ุฎุฏูุฉ ุฅุฏุงุฑุฉ ุฃุณุฑุงุฑ (ูุซู AWS Secrets Manager / HashiCorp Vault) ูููุณ ูู ูููุงุช ุงููุธุงู ุงููุจุงุดุฑุฉ.

### 2. ุฅุนุฏุงุฏุงุช Django ููุฅูุชุงุฌ (`settings.py`)

- [ ] **HTTPS Only:**

    ```python
    SECURE_SSL_REDIRECT = True
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
    SECURE_HSTS_SECONDS = 31536000  # ุณูุฉ ูุงุญุฏุฉ
    SECURE_HSTS_INCLUDE_SUBDOMAINS = True
    SECURE_HSTS_PRELOAD = True
    ```

- [ ] **Allowed Hosts:** ุถุจุท `ALLOWED_HOSTS` ูููุจู ุงููุทุงู ุงูุฑุฆูุณู ูุงููุทุงูุงุช ุงููุฑุนูุฉ: `['.yourdomain.com']`.
- [ ] **CSRF Trust:** ุถุจุท `CSRF_TRUSTED_ORIGINS` ููุชูุงูู ูุน ุงููุทุงู: `['https://*.yourdomain.com']`.

### 3. ุชุญุณูู Docker (Containerization)

- [ ] **Backend Image:** ุงุณุชุฎุฏุงู ุตูุฑุฉ ุฎูููุฉ (`python:3.11-slim`) ูุชูููู ุงูุทุจูุงุช.
- [ ] **Frontend Build:** ุชุญููู ุงูู Frontend ูู ูุถุน ุงูุชุทููุฑ (`npm run dev`) ุฅูู ูุถุน ุงูุจูุงุก (`npm run build`).
  - ุฅูุดุงุก `Dockerfile` ูุชุนุฏุฏ ุงููุฑุงุญู (Multi-stage build):
        1. ูุฑุญูุฉ ุงูุจูุงุก (Node.js): ูุจูุงุก ูููุงุช React ุงูุซุงุจุชุฉ.
        2. ูุฑุญูุฉ ุงูุชุดุบูู (Nginx): ูุชูุฏูู ุงููููุงุช ุงูุซุงุจุชุฉ ุงููุงุชุฌุฉ.

---

## ุงููุฑุญูุฉ 2: ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุฎูุงุฏู (Infrastructure Setup)

*ุงููุฏู: ุฅุนุฏุงุฏ ุจูุฆุฉ ุงุณุชุถุงูุฉ ูููุฉ ุชุฏุนู ุชุนุฏุฏ ุงููุณุชุฃุฌุฑูู.*

### 1. ุฎุงุฏู ุงูููุจ ูุงูุจุฑููุณู ุงูุนูุณู (Nginx)

ูุฌุจ ุงุณุชุจุฏุงู `runserver` ุจู Gunicorn ููุถุนู ุฎูู Nginx.

- [ ] **Gunicorn:** ุฅุนุฏุงุฏ Gunicorn ูุชุดุบูู Django Backend.
  - ุงูุฃูุฑ: `gunicorn tenants.aqua_core.wsgi:application --bind 0.0.0.0:8000 --workers 3`
- [ ] **Nginx Configuration:**
  - ุฅุนุฏุงุฏ `Wildcard Subdomains` ูุชุฏุนู `*.aquaerp.com`.
  - ูุนุงูุฌุฉ `SSL Termination` (ูู ุชุดููุฑ HTTPS).
  - ุชูุฏูู ุงููููุงุช ุงูุซุงุจุชุฉ (`/static/`) ูุงููุณุงุฆุท (`/media/`) ูุจุงุดุฑุฉ ูุชุญุณูู ุงูุฃุฏุงุก.
  - ุฅุนุฏุงุฏ `Proxy Pass` ูุชูุฌูู ุงูุทูุจุงุช ุฅูู ุญุงููุฉ Gunicorn.

### 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช (PostgreSQL)

- [ ] **ูุตู ุงูุจูุงูุงุช:** ููุถู ุงุณุชุฎุฏุงู ุฎุฏูุฉ ูุงุนุฏุฉ ุจูุงูุงุช ููุฏุงุฑุฉ (Managed Database) ูุซู AWS RDS ุฃู DigitalOcean DB ูุถูุงู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู ูุงูุฃูุงูุ ุจุฏูุงู ูู ุงุณุชุถุงูุชูุง ุฏุงุฎู ุญุงููุฉ Docker ุจููุณ ุงูุณูุฑูุฑ (ุงุฎุชูุงุฑู ููููู ููุถู).
- [ ] **Performance Tuning:** ุถุจุท ุฅุนุฏุงุฏุงุช `postgresql.conf` (ูุซู `shared_buffers`, `work_mem`) ูุชูุงุณุจ ููุงุฑุฏ ุงูุฎุงุฏู ุงูุญูููู.
- [ ] **PgBouncer:** (ูุชูุฏู) ุงุณุชุฎุฏุงู PgBouncer ูุฅุฏุงุฑุฉ ุงุชุตุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจููุงุกุฉ ูุน ุชุนุฏุฏ ุงููุณุชุฃุฌุฑูู.

### 3. ุฅุฏุงุฑุฉ ุงููุทุงูุงุช ูุงูุดูุงุฏุงุช (SSL)

- [ ] **DNS:** ุญุฌุฒ ุงููุทุงู ูุชูุฌูู `A Record` (ูููุทุงู ุงูุฑุฆูุณู) ู `CNAME` (ูู `*.yourdomain`) ุฅูู ุนููุงู IP ุงูุฎุงุฏู.
- [ ] **SSL Certificates:** ุงุณุชุฎุฏุงู **Let's Encrypt** ูุน `Certbot` ููุธุฑุงู ูุงุณุชุฎุฏุงู ูุทุงูุงุช ูุฑุนูุฉ (Wildcard)ุ ููุถู ุงุณุชุฎุฏุงู ุชุญุฏู DNS (DNS-01 Challenge) ูุฅุตุฏุงุฑ ุดูุงุฏุฉ ุชุบุทู `*.aquaerp.com`.

---

## ุงููุฑุญูุฉ 3: ุงูุฎุฏูุงุช ุงูุฎูููุฉ ูุงูุฃุชูุชุฉ (Backend Services & Automation)

### 1. ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (SMTP)

ุงูุชุทุจูู ูุญุชุงุฌ ูุฅุฑุณุงู ููุงุชูุฑ ูุฑุณุงุฆู ุชูุนูู.

- [ ] ุฑุจุท ุงููุธุงู ุจุฎุฏูุฉ ุจุฑูุฏ ุงุญุชุฑุงููุฉ (SendGrid, AWS SES, Mailgun).
- [ ] ุฅุนุฏุงุฏ `EMAIL_BACKEND`, `EMAIL_HOST`, `EMAIL_USER` ูู ุฅุนุฏุงุฏุงุช Django.

### 2. ุงูููุงู ุงููุฌุฏููุฉ (Celery & Redis)

- [ ] ุงูุชุฃูุฏ ูู ุฃู ุญุงููุฉ `celery worker` ู `celery beat` ุชุนููุงู ูุชุนููุงู ุนูู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุชููุงุฆู (`restart: always`).
- [ ] ุงุณุชุฎุฏุงู Redis ุจูููุฉ ูุฑูุฑ (`requirepass`) ูุชูุนูู ูุถุน ุงูุงุณุชูุฑุงุฑ (Persistence - RDB/AOF) ูุถูุงู ุนุฏู ุถูุงุน ููุงู ุงูููุงุชูุฑ ูู ุญุงู ุฅุนุงุฏุฉ ุงูุชุดุบูู.

### 3. ุงูุฃุชูุชุฉ (CI/CD Pipeline)

- [ ] ุฅุนุฏุงุฏ **GitHub Actions** ุฃู **GitLab CI**:
    1. **Test:** ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช (`pytest`) ุนูุฏ ูู `push`.
    2. **Build:** ุจูุงุก ุตูุฑ Docker ูุฑูุนูุง ุฅูู Docker Hub ุฃู Container Registry ุฎุงุต.
    3. **Deploy:** ุงูุฏุฎูู ุชููุงุฆูุงู ููุฎุงุฏู ูุณุญุจ ุงูุตูุฑ ุงูุฌุฏูุฏุฉ ูุชุดุบูู `docker-compose up -d`.

---

## ุงููุฑุญูุฉ 4: ุงููุฑุงูุจุฉ ูุงููุณุฎ ุงูุงุญุชูุงุทู (Monitoring & Recovery)

*ุงููุฏู: ุฃู ุชุนุฑู ุจูุฌูุฏ ูุดููุฉ ูุจู ุงูุนููู.*

### 1. ุฅุฏุงุฑุฉ ุงูุฃุฎุทุงุก (Error Tracking)

- [ ] ุชุซุจูุช **Sentry**: ุฑุจุท Django ู React ุจู Sentry ูุงูุชุดุงู ุงูุฃุฎุทุงุก ุงูุจุฑูุฌูุฉ (Exceptions) ูู ุงูููุช ุงูุญูููู ูุน ุชูุงุตูู ุงููุณุชุฎุฏู ูุงูุทูุจ.

### 2. ุงููุณุฎ ุงูุงุญุชูุงุทู (Backups)

- [ ] **Database:** ูุชุงุจุฉ ุณูุฑุจุช `bash` ูููู ุจุนูู `pg_dumpall` ููููุงู ูุฑูุนู ุฅูู ุชุฎุฒูู ุณุญุงุจู ุฎุงุฑุฌู (AWS S3 / Google Drive).
- [ ] **Media Files:** ูุณุฎ ูุฌูุฏ `media/` (ุตูุฑ ุงูููุงุชูุฑ ูุงูุดุนุงุฑุงุช) ุฏูุฑูุงู.

### 3. ุงูุณุฌูุงุช (Logging)

- [ ] ุฅุนุฏุงุฏ ุงูุชุฏููุฑ ููุณุฌูุงุช (Log Rotation) ูู Docker ุญุชู ูุง ุชูุชูุฆ ูุณุงุญุฉ ุงููุฑุต.
- [ ] (ุงุฎุชูุงุฑู) ุฑุจุท ุงูุณุฌูุงุช ุจุฎุฏูุฉ ูุฑูุฒูุฉ ูุซู ELK Stack ุฃู Grafana Loki ุฅุฐุง ูุจุฑ ุงููุดุฑูุน.

---

## ุงููุฑุญูุฉ 5: ุฎุทุฉ ุงูุชูููุฐ ุงูููุงุฆูุฉ (Go-Live Checklist)

1. **Server Provisioning:** ุดุฑุงุก ุฎุงุฏู VPS (Ubuntu 22.04 LTS) ุจููุงุตูุงุช ููุงุณุจุฉ (ูุจุฏุฃ ุจู 4GB RAM / 2 vCPUs).
2. **Initial Setup:** ุชุซุจูุช Docker, Docker Compose, Git, Nginx.
3. **Deployment:**
    - ุณุญุจ ุงูููุฏ (Clone Repo).
    - ุฅุนุฏุงุฏ ููู `.env.prod`.
    - ุจูุงุก ุงูุญุงููุงุช: `docker-compose -f docker-compose.prod.yml up -d --build`.
4. **Database Migration:** ุชุดุบูู `migrate_schemas`.
5. **Static Files:** ุชุดุบูู `collectstatic`.
6. **Create Initial Data:** ุฅูุดุงุก ุงูู Public Tenant ูุงูุฎุทุท (Plans) ูุงูุฃุฏูุงุฑ ุงูุงูุชุฑุงุถูุฉ.
7. **SSL Setup:** ุชุดุบูู Certbot ูุชูุนูู HTTPS.
8. **Smoke Test:**
    - ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ.
    - ุฅูุดุงุก ูุฒุฑุนุฉ.
    - ุฅุตุฏุงุฑ ูุงุชูุฑุฉ ุชุฌุฑูุจูุฉ (ZATCA Simulation).
    - ุงูุชุญูู ูู ูุตูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.

---

## ูููุงุช ููุชุฑุญุฉ ููุฅุถุงูุฉ

### 1. `docker-compose.prod.yml`

ูุฌุจ ุฅูุดุงุก ูุณุฎุฉ ูุฎุตุตุฉ ููุฅูุชุงุฌ ุชุฎุชูู ุนู ุงูุชุทููุฑ (ุจุฏูู ุชุญููู ุงููุฌูุฏุงุช volumes ููููุฏุ ููุท static/mediaุ ูุงุณุชุฎุฏุงู ุตูุฑ ูุจููุฉ).

### 2. `entrypoint.sh`

ุณูุฑุจุช ููุชุฃูุฏ ูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ูุจู ุชุดุบูู Gunicorn.

```bash
#!/bin/sh

if [ "$DATABASE" = "postgres" ]
then
    echo "Waiting for postgres..."
    while ! nc -z $SQL_HOST $SQL_PORT; do
      sleep 0.1
    done
    echo "PostgreSQL started"
fi

# ุชุดุบูู ุงูุชุฑุญููุงุช ูุงููููุงุช ุงูุซุงุจุชุฉ ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุชุดุบูู
python manage.py migrate_schemas --shared
python manage.py collectstatic --noinput

exec "$@"

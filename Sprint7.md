# ๐ Sprint 7: ุฎุงุฑุทุฉ ุทุฑูู ุชุญููู ุงููุธุงู ุฅูู SaaS ูุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช (SaaS & Marketing Layer)

**ุงุณู ุงูููู:** `Sprint7_SaaS_Plan.md`
**ุงููุฏู:** ุฅุทูุงู ุงูุจููุฉ ุงูุชุฌุงุฑูุฉ ูููุธุงู (ุงูุงุดุชุฑุงูุงุชุ ุงูุตูุงุญูุงุชุ ุชุนุฏุฏ ุงููุบุงุช) ููููู ุฌุงูุฒุงู ููุจูุน ูุฎุฏูุฉ SaaS.
**ุงููุฏุฉ ุงูููุฏุฑุฉ:** 8 ุฃูุงู ุนูู.
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุชูููุฐ.

---

## ุฃููุงู: ุงูุชุตููู ุงููุนูุงุฑู (Architecture Design)

### 1. ูููู ุงูุงุดุชุฑุงูุงุช (Public Schema)

ุณูุชู ุฅุถุงูุฉ ููุงุฐุฌ ุฌุฏูุฏุฉ ูู ุงูู `Public Schema` ููุท (ุญูุซ ุชูุฌุฏ ุจูุงูุงุช ุงูุนููุงุก `Client`):

* **Plan (ุงูุจุงูุฉ):** ุชุญุฏุฏ ุงูููุฒุงุชุ ุงูุณุนุฑุ ูุญุฏูุฏ ุงูุงุณุชุฎุฏุงู (ุนุฏุฏ ุงูุฃุญูุงุถุ ุนุฏุฏ ุงููุณุชุฎุฏููู).
* **Subscription (ุงูุงุดุชุฑุงู):** ูุฑุจุท ุงูู `Client` ุจู `Plan` ูุน ุชุงุฑูุฎ ุงูุจุฏุก ูุงูุงูุชูุงุก ูุญุงูุฉ ุงูุฏูุน.

### 2. ูุตูููุฉ ุงูุตูุงุญูุงุช (Tenant Schema - RBAC)

ุฏุงุฎู ูู ูุฒุฑุนุฉุ ุณูุนุชูุฏ ูุธุงู **RBAC (Role-Based Access Control)**:

* **Account Owner (ุงููุงูู):** ููุดุฃ ุชููุงุฆูุงู ุนูุฏ ุงูุชุณุฌููุ ูููู ุตูุงุญูุงุช ูุทููุฉ (`is_superuser=False` ููู ูููู ูู ุงูุตูุงุญูุงุช ูู ุงููุธุงู).
* **Groups (ุงูุฃุฏูุงุฑ):**
  * **Manager (ูุฏูุฑ):** ุชุญูู ูุงูู ุจุงููุฒุฑุนุฉ.
  * **Accountant (ูุญุงุณุจ):** ูุตูู ูููุงููุฉ ูุงููุจูุนุงุช ูุงูุชูุงุฑูุฑ.
  * **Worker (ุนุงูู):** ูุตูู ูุญุฏูุฏ ููุนูููุงุช ุงูููููุฉ (ุนููุ ูููู) ููุท.

### 3. ุงุณุชุฑุงุชูุฌูุฉ ุงููุบุฉ (Localization Strategy)

* **Backend:** ุงุณุชุฎุฏุงู `django.utils.translation` ููููุงุช `.po` ููุชุนุงูู ูุน ุฑุณุงุฆู ุงููุธุงู ูุงูู API.
* **Frontend:** ุฅุฑุณุงู `Accept-Language` headerุ ูุงุณุชุฎุฏุงู ููุชุจุฉ `i18next` ูู React ูุชุจุฏูู ุงููุงุฌูุฉ ูุงุชุฌุงู ุงูุตูุญุฉ (RTL/LTR).

---

## ุซุงููุงู: ุฎุทุฉ ุงูุชูููุฐ ุงูููููุฉ (Day-by-Day Execution)

### ๐ ุงูููู 1: ููุฐุฌุฉ ุงูุจุงูุงุช ูุงูุงุดุชุฑุงูุงุช (SaaS Models)

**ุงูููุงู:** `tenants/models.py` (Public Schema)
**ุงูููุงู:**

1. ุฅูุดุงุก ูููุฐุฌ `Plan` ุจุงูุญููู:
    * `name` (String): (Hatchery, Growth, Enterprise).
    * `price_monthly` (Decimal): (199, 499, 999).
    * `max_users` (Int).
    * `max_ponds` (Int).
    * `features_json` (JSONField): ูุชุฎุฒูู ุงูููุฒุงุช ุงููุชุงุญุฉ (ูุซูุงู: `{"zatca_phase2": true}`).
2. ุฅูุดุงุก ูููุฐุฌ `Subscription` ุจุงูุญููู:
    * `client` (ForeignKey).
    * `plan` (ForeignKey).
    * `status` (Active, Suspended, Expired).
    * `end_date` (Date).
3. ุฅูุดุงุก **Command** ูููุก ุงูุจุงูุงุช ุงูุงูุชุฑุงุถูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`python manage.py seed_plans`).

### ๐ ุงูููู 2: ููุญุฉ ุชุญูู ูุฏูุฑ ุงููุธุงู (SaaS Admin Dashboard)

**ุงูููุงู:** ุชุทุจูู ุฌุฏูุฏ `apps/saas_dashboard` (ูุนูู ุนูู Public Schema ููุท).
**ุงูููุงู:**

1. ุชุตููู ูุงุฌูุฉ API ุฎุงุตุฉ ูููุณุคูู ุงูุนุงู (Super Admin) ูู:
    * ุณุฑุฏ ุฌููุน ุงููุฒุงุฑุน ุงููุดุชุฑูุฉ ูุญุงูุชูุง.
    * ุชูุนูู/ุฅููุงู ุงุดุชุฑุงู ูุฒุฑุนุฉ ูุฏููุงู.
    * ุชุฑููุฉ ุจุงูุฉ ุนููู.
2. ุจูุงุก ูุงุฌูุฉ ุฃูุงููุฉ (Frontend Page) ูููุตูุฉ `/saas-admin`:
    * **Cards:** ุฅุฌูุงูู ุงูุฏุฎู ุงูุดูุฑูุ ุนุฏุฏ ุงููุฒุงุฑุน ุงููุดุทุฉุ ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ ูุฑูุจุงู.
    * ุฌุฏูู ุจุจูุงูุงุช ุงููุดุชุฑููู ูุน ุฒุฑ "ุฅููุงู ุงูุฎุฏูุฉ" (Suspend).

### ๐ ุงูููู 3: ุฏูุฑุฉ ุญูุงุฉ ุงูุชุณุฌูู ูุฅูุดุงุก ุงููุงูู (Sign-up Flow)

**ุงูููุงู:** `apps/accounts` ู `tenants/views.py`
**ุงูููุงู:**

1. ุจูุงุก **Public Registration API**:
    * ูููู ุงููุณุชุฎุฏู ุจุฅุฏุฎุงู (ุงุณู ุงูุดุฑูุฉุ ุงูุฏูููู ุงููุฑุนู ุงููุทููุจุ ุงูุงููููุ ูููุฉ ุงููุฑูุฑ).
2. **Transaction Logic (ุงูุชูููุฐ ุงููุชุฒุงูู):**
    * ุฅูุดุงุก `Client` + `Domain`.
    * ุฅูุดุงุก `Subscription` (ูุชุฑุฉ ุชุฌุฑูุจูุฉ 14 ููู ุงูุชุฑุงุถูุงู).
    * **ูุงู:** ุงูุงูุชูุงู ูุฏุงุฎู ุงูู Schema ุงูุฌุฏูุฏุฉ ูุฅูุดุงุก ูุณุชุฎุฏู (User) ุจููุณ ุงูุงูููู ูุงูุจุงุณูุฑุฏ ูููุญู ุตูุงุญูุฉ `Owner`.
3. ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ุชุฑุญูุจู ูุญุชูู ุนูู ุฑุงุจุท ุงูุฏุฎูู (`farm.aquaerp.com`).

### ๐ ุงูููู 4: Middleware ุงูุชุญูู ูู ุงูุงุดุชุฑุงู (The Gatekeeper)

**ุงูููุงู:** `aqua_core/middleware.py`
**ุงูููุงู:**

1. ูุชุงุจุฉ `SubscriptionMiddleware`:
    * ูุนูู ุจุนุฏ ุชุญุฏูุฏ ุงูู Tenant.
    * ูุชุญูู ูู ุฌุฏูู `Subscription` ูู ุงูู Public Schema.
    * ุฅุฐุง ูุงู ุงูุงุดุชุฑุงู ููุชููุงู (`Expired`) ุฃู ูุชูููุงู (`Suspended`)ุ ูุนูุฏ ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ "ูุฑุฌู ุชุฌุฏูุฏ ุงูุงุดุชุฑุงู" ููุญุฌุจ ุงููุตูู ููุจูุงูุงุช.
    * ุงุณุชุซูุงุก ูุณุงุฑุงุช ูุนููุฉ (ูุซู ุตูุญุฉ ุงูุฏูุน) ูู ุงูุญุฌุจ.

### ๐ ุงูููู 5: ูุธุงู ุงูุตูุงุญูุงุช ุงูุฏุงุฎูู (Intra-Company RBAC)

**ุงูููุงู:** `apps/accounts` (ุฏุงุฎู Tenant Schema)
**ุงูููุงู:**

1. ุฅูุดุงุก ูุฌููุนุงุช ุงูุชุฑุงุถูุฉ (Signals post_migrate):
    * **Manager:** ูู ุงูุตูุงุญูุงุช ูุง ุนุฏุง ุญุฐู ุงูุจูุงูุงุช ุงููุงููุฉ ุงูุญุณุงุณุฉ.
    * **Accountant:** ุตูุงุญูุงุช (View, Add) ูู ุงููุญุงุณุจุฉ ูุงููุจูุนุงุช ููุท.
    * **Worker:** ุตูุงุญูุงุช (Add) ูู ุงูุนูููุงุช ุงูููููุฉ (ุนููุ ูููู) ููุท.
2. ุชุทููุฑ ูุงุฌูุฉ "ุฅุฏุงุฑุฉ ุงูููุธููู" ูููุงูู:
    * API ูุฏุนูุฉ ููุธู ุฌุฏูุฏ.
    * API ูุชุนููู ุงูุฏูุฑ (Group) ููููุธู.
3. ุชุทุจูู `PermissionClasses` ูู ุงูู APIs ุงูุญุณุงุณุฉ.

### ๐ ุงูููู 6: ุงูุจููุฉ ุงูุชุญุชูุฉ ููุบุฉ (Localization Backend)

**ุงูููุงู:** `settings.py` ู `LOCALE_PATHS`
**ุงูููุงู:**

1. ุชูุนูู `USE_I18N = True`.
2. ุชุญุฏูุฏ ุงููุบุงุช: `LANGUAGES = (('ar', 'Arabic'), ('en', 'English'))`.
3. ุชุดุบูู ุฃูุฑ `makemessages` ูุชูููุฏ ูููุงุช `.po`.
4. ุชุฑุฌูุฉ ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุฃุณุงุณูุฉ ูุฃุณูุงุก ุงูุญููู.
5. ุฅูุดุงุก API `POST /api/set-language/` ูุชุนููู ูุบุฉ ุงูุฌูุณุฉ.

### ๐ ุงูููู 7: ูุงุฌูุฉ ุงููุณุชุฎุฏู ุซูุงุฆูุฉ ุงููุบุฉ (Frontend RTL/LTR)

**ุงูููุงู:** React App & Tailwind Config
**ุงูููุงู:**

1. ุฅุนุฏุงุฏ `i18next` ูู React.
2. ุฅูุดุงุก ูููุงุช `ar.json` ู `en.json`.
3. **RTL Support:**
    * ุชูููู Tailwind ูุฏุนู `rtl:` modifier.
    * ุฅุถุงูุฉ ุณูุฉ `dir="rtl"` ููุณู `<html>` ุนูุฏ ุงุฎุชูุงุฑ ุงูุนุฑุจูุฉ.
    * ุงูุชุฃูุฏ ูู ุงูุนูุงุณ ุงูููุงุฆู ูุงูุฌุฏุงูู.

### ๐ ุงูููู 8: ุงููุฑุงุฌุนุฉ ูุงูุฏูุฌ (Integration & Polish)

**ุงูููุงู:**

1. ุชุฌุฑุจุฉ ุฏูุฑุฉ ูุงููุฉ (ุชุณุฌูู ุดุฑูุฉ -> ุฅูุดุงุก ูุงูู -> ุฅุถุงูุฉ ูุณุชุฎุฏู -> ุชุบููุฑ ูุบุฉ).
2. ุงูุชุญูู ูู ุญุฌุจ ุงูุฎุฏูุฉ ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู.
3. ูุฑุงุฌุนุฉ ุงููุตูุต ุงูุนุฑุจูุฉ ููุชุฃูุฏ ูู ุฏูุชูุง.

---

## ุซุงูุซุงู: ุฌุฏูู ุงูุชุณุนูุฑ ุงูููุชุฑุญ (Database Seed Data)

| ุงูููุฒุฉ | ุจุงูุฉ ุงูุจุฏุงูุฉ (Hatchery) | ุจุงูุฉ ุงูููู (Growth) | ุจุงูุฉ ุงูุดุฑูุงุช (Enterprise) |
| :--- | :--- | :--- | :--- |
| **ุงูุณุนุฑ ุงูุดูุฑู** | **199 ุฑ.ุณ** | **499 ุฑ.ุณ** | **999 ุฑ.ุณ** |
| **ุนุฏุฏ ุงููุณุชุฎุฏููู** | 2 | 5 | ููุชูุญ |
| **ุนุฏุฏ ุงูุฃุญูุงุถ** | 10 | 50 | ููุชูุญ |
| **ุงููุงุชูุฑุฉ ุงูุฅููุชุฑูููุฉ** | ุบูุฑ ูุดููู | ูุดููู (ZATCA Phase 2) | ูุดููู (ZATCA Phase 2) |
| **ุฏุนู ููู** | ุงูููู | ูุงุชุณุงุจ | ูุฏูุฑ ุญุณุงุจ |

---

## ุฑุงุจุนุงู: ุงููุฎุฑุฌุงุช ุงูููุงุฆูุฉ (Deliverables)

1. ูุธุงู ุชุณุฌูู (SaaS Signup) ุขูู ุจุงููุงูู.
2. ุจูุงุจุฉ ุฏูุน (Mock) ูุชูุนูู ุงูุงุดุชุฑุงูุงุช.
3. ููุญุฉ ุชุญูู "Super Admin" ูุฅุฏุงุฑุฉ ุงูุนููุงุก.
4. ุฏุนู ูุงูู ููุบุชูู (ุนุฑุจู/ุฅูุฌููุฒู) ูุน RTL.
5. ูุธุงู ุตูุงุญูุงุช ุฏุงุฎูู ูุญูู ุงูุจูุงูุงุช ุงููุงููุฉ.

### ๐ ุงูููู 8: ุตูุญุฉ ุงูุฏุนู ูุนู ุงูููุชุฌ (About & Support Page)

ุงูููุงู: apps/core (Backend) ู components/Support (Frontend)

ุงูููุงู:

1. ุฅูุดุงุก ุตูุญุฉ "ุญูู ุงููุธุงู" (About) ุชุธูุฑ ูู ูุงุฆูุฉ ุงูุฅุนุฏุงุฏุงุช.

2. ุนุฑุถ ูุนูููุงุช ุงูุฅุตุฏุงุฑ (Version 1.0.0).

3. ุนุฑุถ ุจุทุงูุฉ "ุงูุฏุนู ุงูููู" (Technical Support Card) ุชุญุชูู ุนูู ุจูุงูุงุช ุงููุทูุฑ.

4. ุฑุจุท ุฑูู ุงููุงุชู ุจู WhatsApp API ูุจุงุดุฑุฉ ูุณูููุฉ ุงูุชูุงุตู
